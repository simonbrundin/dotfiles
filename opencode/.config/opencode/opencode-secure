#!/bin/bash
# Wrapper to run opencode with 1Password secrets
# Usage: opencode [args...]

ENV_FILE="$HOME/repos/dotfiles/opencode/.config/opencode/.env"

if [[ -f "$ENV_FILE" ]]; then
  export GITHUB_TOKEN="$(op run --no-masking --env-file="$ENV_FILE" -- printenv GITHUB_TOKEN 2>/dev/null)"
  export GITHUB_PERSONAL_ACCESS_TOKEN="$GITHUB_TOKEN"
  export OPENROUTER_API_KEY="$(op run --no-masking --env-file="$ENV_FILE" -- printenv OPENROUTER_API_KEY 2>/dev/null)"
  exec opencode "$@"
else
  echo "Error: $ENV_FILE not found"
  exit 1
fi
